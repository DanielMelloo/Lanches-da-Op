{% extends "base.html" %}

{% block title %}Dashboard - Lanches OP{% endblock %}

{% block content %}
<div class="card glass-panel text-center mb-lg">
    <h2>Ol√°, <span class="text-accent">{{ current_user.name }}</span>!</h2>
    <p class="text-muted">Bem-vindo ao Lanches OP.</p>
</div>

<!-- Subsites Section (Static) -->
<h3 class="mb-md">O que vamos pedir hoje?</h3>
<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;">
    {% for subsite in subsites %}
    <div class="card glass-panel text-center" style="cursor: pointer; transition: transform 0.2s;"
        onclick="window.location.href='{{ url_for('user.menu', subsite_id=subsite.id) }}'">
        <i class="{{ subsite.icon_class or 'ph-duotone ph-storefront' }}"
            style="font-size: 48px; color: var(--accent-cyan); margin-bottom: 15px;"></i>
        <h4 style="margin: 0;">{{ subsite.name }}</h4>
    </div>
    {% endfor %}
</div>

<!-- Recent Orders Section (Async) -->
<div class="mt-xl">
    <div class="flex justify-between items-center mb-md">
        <h3>Meus Pedidos Recentes</h3>
        <a href="{{ url_for('user.orders') }}" class="btn-secondary"
            style="height: 36px; padding: 0 15px; font-size: 0.9em;">
            Ver Tudo
        </a>
    </div>

    <div id="dashboard-orders-container">
        <!-- SKELETON LOADER -->
        {% for i in range(3) %}
        <div class="glass-panel"
            style="padding: 15px; margin-bottom: 10px; border-left: 4px solid rgba(255,255,255,0.1);">
            <div class="flex justify-between mb-xs">
                <div style="width: 120px; height: 16px; background: rgba(255,255,255,0.05); border-radius: 4px;"></div>
                <div style="width: 80px; height: 16px; background: rgba(255,255,255,0.05); border-radius: 4px;"></div>
            </div>
            <div class="flex justify-between items-center">
                <div style="width: 100px; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px;"></div>
                <div style="width: 60px; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px;"></div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/user/api/dashboard/orders')
            .then(response => response.text())
            .then(html => {
                const container = document.getElementById('dashboard-orders-container');
                container.style.opacity = '0';
                setTimeout(() => {
                    container.innerHTML = html;
                    container.style.transition = 'opacity 0.3s ease';
                    container.style.opacity = '1';
                }, 200);
            })
            .catch(err => console.error('Error loading orders:', err));
    });
</script>
{% endblock %}